<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Disease Classifier</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                    <path d="M2 17l10 5 10-5"/>
                    <path d="M2 12l10 5 10-5"/>
                </svg>
                <h1>Plant Disease Classifier</h1>
            </div>
            <div class="header-status">
                <span class="status-indicator" id="apiStatus">
                    <span class="status-dot"></span>
                    <span class="status-text">Checking...</span>
                </span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Mode Selection Tabs -->
        <div class="tabs-container">
            <div class="tabs">
                <button class="tab" data-mode="compare">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="8" height="18" rx="1"/>
                        <rect x="13" y="3" width="8" height="18" rx="1"/>
                        <path d="M7 8h0M7 12h0M7 16h0"/>
                        <path d="M17 8h0M17 12h0M17 16h0"/>
                    </svg>
                    Compare Models
                </button>
                <button class="tab" data-mode="early-warning">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                        <line x1="12" y1="9" x2="12" y2="13"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                    Early Warning
                </button>
                <button class="tab active" data-mode="full">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 6v6l4 2"/>
                    </svg>
                    Full Analysis
                </button>
                <button class="tab" data-mode="species">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2a10 10 0 0 1 10 10c0 5.52-4.48 10-10 10S2 17.52 2 12"/>
                        <path d="M12 2v10l7 4"/>
                    </svg>
                    Species Only
                </button>
                <button class="tab" data-mode="disease">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                    </svg>
                    Disease Only
                </button>
                <button class="tab" data-mode="batch">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"/>
                        <rect x="14" y="3" width="7" height="7"/>
                        <rect x="14" y="14" width="7" height="7"/>
                        <rect x="3" y="14" width="7" height="7"/>
                    </svg>
                    Batch (10 max)
                </button>
                <button class="tab" data-mode="training">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
                    </svg>
                    Training
                </button>
            </div>
        </div>

        <!-- Upload Section -->
        <div class="upload-section">
            <div class="upload-area" id="uploadArea">
                <div class="upload-content">
                    <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                    <h3>Drop your plant image here</h3>
                    <p>or click to browse</p>
                    <span class="upload-hint">Supports JPG, PNG (max 10MB)</span>
                </div>
                <input type="file" id="fileInput" accept="image/*" hidden>
                <input type="file" id="batchFileInput" accept="image/*" multiple hidden>
            </div>

            <!-- Preview Area -->
            <div class="preview-area" id="previewArea" style="display: none;">
                <div class="preview-header">
                    <h3>Selected Image<span id="imageCount"></span></h3>
                    <button class="btn-clear" id="clearBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                        Clear
                    </button>
                </div>
                <div class="preview-images" id="previewImages"></div>
            </div>

            <!-- Options -->
            <div class="options-panel" id="optionsPanel">
                <!-- Model Selection for Full Analysis Mode -->
                <div class="option-group full-analysis-option" id="fullAnalysisModelPanel">
                    <label class="option-label-inline">Analysis Model:</label>
                    <select id="analysisModelSelect" class="select-input">
                        <option value="internal">Internal Model (Default)</option>
                        <option value="mobilenet_v2">MobileNetV2 (HuggingFace)</option>
                        <option value="vit_crop">ViT Crop Diseases (HuggingFace)</option>
                        <option value="resnet50_plant">ResNet50 (HuggingFace)</option>
                        <option value="efficientnet_plant">EfficientNet (HuggingFace)</option>
                        <option value="plantnet">Pl@ntNet API (External)</option>
                        <option value="kindwise">Plant.id/Kindwise API (External)</option>
                    </select>
                </div>
                <div class="option-group">
                    <label class="option-label">
                        <input type="checkbox" id="includeTreatment" checked>
                        <span class="checkbox-custom"></span>
                        Include Treatment Recommendations
                    </label>
                </div>
                <div class="option-group">
                    <label class="option-label">
                        <input type="checkbox" id="includeExplainability" checked>
                        <span class="checkbox-custom"></span>
                        Include Model Explainability
                    </label>
                </div>
                <div class="option-group">
                    <label class="option-label-inline">Region (optional):</label>
                    <select id="regionSelect" class="select-input">
                        <option value="">No region filter</option>
                        <option value="US-CA">California, USA</option>
                        <option value="US-FL">Florida, USA</option>
                        <option value="US-TX">Texas, USA</option>
                        <option value="EU">European Union</option>
                        <option value="IN-MH">Maharashtra, India</option>
                        <option value="IN-KA">Karnataka, India</option>
                        <option value="AU">Australia</option>
                    </select>
                </div>
                <div class="option-group disease-only-option" id="cropOption" style="display: none;">
                    <label class="option-label-inline">Crop Type (for disease detection):</label>
                    <select id="cropSelect" class="select-input">
                        <option value="">Auto-detect</option>
                        <option value="tomato">Tomato</option>
                        <option value="potato">Potato</option>
                        <option value="apple">Apple</option>
                        <option value="corn">Corn</option>
                        <option value="grape">Grape</option>
                    </select>
                </div>

                <!-- Model Selection for Compare Mode -->
                <div class="option-group compare-models-option" id="modelSelectionPanel" style="display: none;">
                    <h4 class="model-selection-title">Select Models to Compare</h4>
                    <p class="model-selection-hint">Choose which models to run your image through for comparison</p>

                    <div class="model-checkboxes">
                        <label class="model-checkbox">
                            <input type="checkbox" id="modelInternal" value="internal" checked>
                            <span class="checkbox-custom"></span>
                            <div class="model-info">
                                <span class="model-name">Internal Model</span>
                                <span class="model-desc">Our MobileNetV2-based classifier with species + disease detection</span>
                                <span class="model-badge real">Real ML</span>
                            </div>
                        </label>

                        <label class="model-checkbox">
                            <input type="checkbox" id="modelMobileNet" value="mobilenet_v2" checked>
                            <span class="checkbox-custom"></span>
                            <div class="model-info">
                                <span class="model-name">MobileNetV2 (HuggingFace)</span>
                                <span class="model-desc">38 PlantVillage classes, ~95.4% accuracy</span>
                                <span class="model-badge hf">HuggingFace</span>
                            </div>
                        </label>

                        <label class="model-checkbox">
                            <input type="checkbox" id="modelViT" value="vit_crop">
                            <span class="checkbox-custom"></span>
                            <div class="model-info">
                                <span class="model-name">ViT Crop Diseases (HuggingFace)</span>
                                <span class="model-desc">14 classes (Corn, Potato, Rice, Wheat), ~98% accuracy</span>
                                <span class="model-badge hf">HuggingFace</span>
                            </div>
                        </label>

                        <label class="model-checkbox">
                            <input type="checkbox" id="modelResNet50" value="resnet50_plant">
                            <span class="checkbox-custom"></span>
                            <div class="model-info">
                                <span class="model-name">ResNet50 Plant Disease (HuggingFace)</span>
                                <span class="model-desc">Deep ResNet architecture, PlantVillage trained</span>
                                <span class="model-badge hf">HuggingFace</span>
                            </div>
                        </label>

                        <label class="model-checkbox">
                            <input type="checkbox" id="modelEfficientNet" value="efficientnet_plant">
                            <span class="checkbox-custom"></span>
                            <div class="model-info">
                                <span class="model-name">EfficientNet Plant Disease (HuggingFace)</span>
                                <span class="model-desc">Efficient architecture with high accuracy</span>
                                <span class="model-badge hf">HuggingFace</span>
                            </div>
                        </label>

                        <label class="model-checkbox">
                            <input type="checkbox" id="modelPlantNet" value="plantnet">
                            <span class="checkbox-custom"></span>
                            <div class="model-info">
                                <span class="model-name">Pl@ntNet API</span>
                                <span class="model-desc">50,000+ species identification</span>
                                <span class="model-badge api">External API</span>
                            </div>
                        </label>

                        <label class="model-checkbox">
                            <input type="checkbox" id="modelKindwise" value="kindwise">
                            <span class="checkbox-custom"></span>
                            <div class="model-info">
                                <span class="model-name">Plant.id / Kindwise API</span>
                                <span class="model-desc">Superior accuracy, health assessment included</span>
                                <span class="model-badge api">External API</span>
                            </div>
                        </label>
                    </div>

                    <!-- API Key Configuration -->
                    <div class="api-key-config">
                        <h5>API Key Configuration</h5>
                        <p class="api-key-hint">External APIs require API keys. Configure them here or via environment variables.</p>
                        <div class="api-key-inputs">
                            <div class="api-key-input-group">
                                <label for="plantnetApiKey">PlantNet API Key:</label>
                                <input type="password" id="plantnetApiKey" placeholder="Enter PlantNet API key" class="api-key-input">
                                <a href="https://my.plantnet.org/" target="_blank" class="api-key-link">Get key</a>
                            </div>
                            <div class="api-key-input-group">
                                <label for="kindwiseApiKey">Kindwise API Key:</label>
                                <input type="password" id="kindwiseApiKey" placeholder="Enter Kindwise API key" class="api-key-input">
                                <a href="https://www.kindwise.com/" target="_blank" class="api-key-link">Get key</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Early Warning Mode Options -->
                <div class="option-group early-warning-option" id="earlyWarningPanel" style="display: none;">
                    <div class="early-warning-intro">
                        <h4>
                            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                                <line x1="12" y1="9" x2="12" y2="13"/>
                                <line x1="12" y1="17" x2="12.01" y2="17"/>
                            </svg>
                            AI Crop Disease Early Warning System
                        </h4>
                        <p>This mode runs ALL available models in parallel to provide:</p>
                        <ul>
                            <li>Comprehensive disease identification with model consensus</li>
                            <li>Severity scoring with urgency assessment</li>
                            <li>Detailed explanation of each model's analysis</li>
                            <li>Localized treatment recommendations</li>
                        </ul>
                    </div>
                    <div class="api-key-config">
                        <h5>API Keys (Optional - Enables More Models)</h5>
                        <div class="api-key-inputs">
                            <div class="api-key-input-group">
                                <label for="ewPlantnetApiKey">PlantNet:</label>
                                <input type="password" id="ewPlantnetApiKey" placeholder="PlantNet API key" class="api-key-input">
                                <a href="https://my.plantnet.org/" target="_blank" class="api-key-link">Get key</a>
                            </div>
                            <div class="api-key-input-group">
                                <label for="ewKindwiseApiKey">Kindwise:</label>
                                <input type="password" id="ewKindwiseApiKey" placeholder="Kindwise API key" class="api-key-input">
                                <a href="https://www.kindwise.com/" target="_blank" class="api-key-link">Get key</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Training Mode Panel -->
                <div class="option-group training-option" id="trainingPanel" style="display: none;">
                    <div class="training-intro">
                        <h4>
                            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
                            </svg>
                            Local Model Training
                        </h4>
                        <p>Train and fine-tune plant disease classification models locally on your Mac.</p>
                    </div>

                    <!-- Dataset Section -->
                    <div class="training-section">
                        <h5>1. Dataset</h5>
                        <div class="dataset-status" id="datasetStatus">
                            <div class="status-indicator checking">
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                </svg>
                                <span>Checking dataset status...</span>
                            </div>
                        </div>
                        <div class="dataset-actions">
                            <button class="btn-secondary" id="downloadDatasetBtn">
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7 10 12 15 17 10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Download PlantVillage Dataset
                            </button>
                            <select id="datasetSelect" class="select-input">
                                <option value="plantvillage">PlantVillage (54K images, 38 classes)</option>
                                <option value="plantdoc">PlantDoc (2.5K real-world images)</option>
                                <option value="custom">Custom Dataset</option>
                            </select>
                        </div>
                        <div class="download-progress" id="downloadProgress" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="downloadProgressFill"></div>
                            </div>
                            <span class="progress-text" id="downloadProgressText">0%</span>
                        </div>
                    </div>

                    <!-- Training Configuration -->
                    <div class="training-section">
                        <h5>2. Training Configuration</h5>
                        <div class="training-config-grid">
                            <div class="config-item">
                                <label for="baseModel">Base Model:</label>
                                <select id="baseModel" class="select-input">
                                    <option value="efficientnet_b0">EfficientNet-B0 (Fast, ~95% acc)</option>
                                    <option value="efficientnet_b2">EfficientNet-B2 (Better, ~96% acc)</option>
                                    <option value="resnet50">ResNet50 (Classic, ~95% acc)</option>
                                    <option value="mobilenet_v2" selected>MobileNetV2 (Fastest, ~94% acc)</option>
                                    <option value="vit_small">ViT-Small (Transformer, ~97% acc)</option>
                                </select>
                            </div>
                            <div class="config-item">
                                <label for="epochs">Epochs:</label>
                                <input type="number" id="epochs" value="10" min="1" max="100" class="input-number">
                            </div>
                            <div class="config-item">
                                <label for="batchSize">Batch Size:</label>
                                <select id="batchSize" class="select-input">
                                    <option value="8">8 (Low memory)</option>
                                    <option value="16">16 (Recommended for Mac)</option>
                                    <option value="32" selected>32 (Default)</option>
                                    <option value="64">64 (High memory)</option>
                                </select>
                            </div>
                            <div class="config-item">
                                <label for="learningRate">Learning Rate:</label>
                                <select id="learningRate" class="select-input">
                                    <option value="0.0001" selected>1e-4 (Default)</option>
                                    <option value="0.00001">1e-5 (Fine-tuning)</option>
                                    <option value="0.001">1e-3 (Fast learning)</option>
                                </select>
                            </div>
                            <div class="config-item">
                                <label for="device">Device:</label>
                                <select id="device" class="select-input">
                                    <option value="auto" selected>Auto (MPS if available)</option>
                                    <option value="mps">Apple Silicon GPU (MPS)</option>
                                    <option value="cpu">CPU Only</option>
                                </select>
                            </div>
                            <div class="config-item">
                                <label for="augmentation">Data Augmentation:</label>
                                <select id="augmentation" class="select-input">
                                    <option value="standard" selected>Standard (Flip, Rotate, Color)</option>
                                    <option value="aggressive">Aggressive (More variations)</option>
                                    <option value="none">None</option>
                                </select>
                            </div>
                        </div>
                        <div class="config-checkboxes">
                            <label class="option-label">
                                <input type="checkbox" id="enableWandb">
                                <span class="checkbox-custom"></span>
                                Enable Weights & Biases Logging
                            </label>
                            <label class="option-label">
                                <input type="checkbox" id="saveCheckpoints" checked>
                                <span class="checkbox-custom"></span>
                                Save Checkpoints Every Epoch
                            </label>
                            <label class="option-label">
                                <input type="checkbox" id="enableEarlyStopping" checked>
                                <span class="checkbox-custom"></span>
                                Early Stopping (patience=5)
                            </label>
                        </div>
                    </div>

                    <!-- Training Actions -->
                    <div class="training-actions">
                        <button class="btn-primary btn-large" id="startTrainingBtn">
                            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="5 3 19 12 5 21 5 3"/>
                            </svg>
                            Start Training
                        </button>
                        <button class="btn-secondary" id="stopTrainingBtn" disabled>
                            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="6" y="6" width="12" height="12"/>
                            </svg>
                            Stop
                        </button>
                    </div>
                </div>
            </div>

            <!-- Analyze Button -->
            <button class="btn-analyze" id="analyzeBtn" disabled>
                <span class="btn-text">Analyze Plant</span>
                <span class="btn-loading">
                    <svg class="spinner" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" stroke-dasharray="31.4" stroke-dashoffset="10"/>
                    </svg>
                    Analyzing...
                </span>
            </button>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection" style="display: none;">
            <div class="results-header">
                <h2>Analysis Results</h2>
                <div class="results-meta" id="resultsMeta"></div>
            </div>

            <!-- Error Display -->
            <div class="error-container" id="errorContainer" style="display: none;">
                <div class="error-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                </div>
                <div class="error-content">
                    <h3 class="error-title">Analysis Failed</h3>
                    <p class="error-message" id="errorMessage"></p>
                    <button class="btn-retry" id="retryBtn">Try Again</button>
                </div>
            </div>

            <!-- Single Result -->
            <div class="result-cards" id="singleResult" style="display: none;">
                <!-- Plant Identification Card -->
                <div class="result-card plant-card">
                    <div class="card-header">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v8m0 0c-2 0-4 1-4 4 0 2 2 6 4 8 2-2 4-6 4-8 0-3-2-4-4-4z"/>
                            <path d="M12 10c2-4 6-4 8-2"/>
                            <path d="M12 10c-2-4-6-4-8-2"/>
                        </svg>
                        <h3>Plant Identification</h3>
                    </div>
                    <div class="card-body">
                        <div class="taxonomy-tree" id="taxonomyTree"></div>
                        <div class="common-name" id="commonName"></div>
                        <div class="alternatives" id="alternatives"></div>
                    </div>
                </div>

                <!-- Health Assessment Card -->
                <div class="result-card health-card">
                    <div class="card-header">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                        </svg>
                        <h3>Health Assessment</h3>
                    </div>
                    <div class="card-body">
                        <div class="health-status" id="healthStatus"></div>
                        <div class="disease-info" id="diseaseInfo"></div>
                        <div class="symptoms-list" id="symptomsList"></div>
                    </div>
                </div>

                <!-- Treatment Card -->
                <div class="result-card treatment-card" id="treatmentCard" style="display: none;">
                    <div class="card-header">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>
                        </svg>
                        <h3>Treatment Recommendations</h3>
                    </div>
                    <div class="card-body">
                        <div class="treatment-urgency" id="treatmentUrgency"></div>
                        <div class="treatment-tabs">
                            <button class="treatment-tab active" data-treatment="organic">Organic</button>
                            <button class="treatment-tab" data-treatment="chemical">Chemical</button>
                            <button class="treatment-tab" data-treatment="prevention">Prevention</button>
                        </div>
                        <div class="treatment-content" id="treatmentContent"></div>
                        <div class="region-notes" id="regionNotes"></div>
                        <div class="data-source" id="treatmentDataSource"></div>
                    </div>
                </div>

                <!-- Explainability Card -->
                <div class="result-card explain-card" id="explainCard" style="display: none;">
                    <div class="card-header">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                            <line x1="12" y1="17" x2="12.01" y2="17"/>
                        </svg>
                        <h3>Model Explainability</h3>
                    </div>
                    <div class="card-body">
                        <div class="reasoning" id="modelReasoning"></div>
                        <div class="confidence-notes" id="confidenceNotes"></div>
                        <div class="key-features" id="keyFeatures"></div>
                        <div class="uncertainty" id="uncertaintyFactors"></div>
                        <div class="grad-cam-section" id="gradCamSection" style="display: none;">
                            <h4>Attention Heatmap</h4>
                            <img class="grad-cam-image" id="gradCamImage" alt="Grad-CAM visualization">
                            <div class="focus-regions" id="focusRegions"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Batch Results -->
            <div class="batch-results" id="batchResults" style="display: none;">
                <div class="batch-summary" id="batchSummary"></div>
                <div class="batch-grid" id="batchGrid"></div>
            </div>

            <!-- Comparison Results -->
            <div class="comparison-results" id="comparisonResults" style="display: none;">
                <div class="comparison-header">
                    <h3>Model Comparison Results</h3>
                    <div class="agreement-score" id="agreementScore"></div>
                </div>

                <div class="comparison-recommendation" id="comparisonRecommendation"></div>

                <div class="comparison-grid" id="comparisonGrid">
                    <!-- Model results will be inserted here -->
                </div>

                <div class="comparison-meta" id="comparisonMeta"></div>
            </div>

            <!-- Early Warning Results -->
            <div class="early-warning-results" id="earlyWarningResults" style="display: none;">
                <!-- Severity Section -->
                <div class="severity-section" id="severitySection">
                <!-- Severity Banner -->
                <div class="severity-banner" id="severityBanner">
                    <div class="severity-indicator" id="severityIndicator">
                        <div class="severity-score" id="severityScore">0</div>
                        <div class="severity-label" id="severityLabel">Analyzing...</div>
                    </div>
                    <div class="severity-info">
                        <h3 id="severityUrgency">Calculating severity...</h3>
                        <p id="severityTimeline">Please wait for analysis</p>
                    </div>
                </div>
                </div>

                <!-- Consensus Section -->
                <div class="ew-section consensus-section">
                    <h3>
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        Disease Identification
                    </h3>
                    <div class="consensus-content" id="consensusContent">
                        <!-- Consensus details inserted here -->
                    </div>
                </div>

                <!-- Model Predictions Section -->
                <div class="ew-section models-section">
                    <h3>
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"/>
                            <rect x="14" y="3" width="7" height="7"/>
                            <rect x="14" y="14" width="7" height="7"/>
                            <rect x="3" y="14" width="7" height="7"/>
                        </svg>
                        Model Analysis Breakdown
                    </h3>
                    <p class="section-hint">Each model's prediction with detailed explanation</p>
                    <div class="model-predictions-grid" id="modelPredictionsGrid">
                        <!-- Model prediction cards inserted here -->
                    </div>
                </div>

                <!-- Treatment Section -->
                <div class="ew-section treatment-section" id="treatmentCardEW">
                    <div class="card-content">
                    <h3>
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>
                        </svg>
                        Treatment Recommendations
                    </h3>

                    <div class="treatment-tabs-ew">
                        <button class="treatment-tab-ew active" data-treatment-ew="immediate">Immediate Actions</button>
                        <button class="treatment-tab-ew" data-treatment-ew="organic">Organic</button>
                        <button class="treatment-tab-ew" data-treatment-ew="chemical">Chemical</button>
                        <button class="treatment-tab-ew" data-treatment-ew="prevention">Prevention</button>
                    </div>

                    <div class="treatment-content-ew" id="treatmentContentEW">
                        <!-- Treatment content inserted here -->
                    </div>

                    <div class="treatment-meta-ew" id="treatmentMetaEW">
                        <!-- Recovery estimate, monitoring schedule -->
                    </div>
                    </div>
                </div>

                <!-- Severity Factors Section -->
                <div class="ew-section factors-section">
                    <h3>
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="16" x2="12" y2="12"/>
                            <line x1="12" y1="8" x2="12.01" y2="8"/>
                        </svg>
                        Severity Analysis Factors
                    </h3>
                    <div class="factors-list" id="factorsList">
                        <!-- Severity factors inserted here -->
                    </div>
                </div>

                <!-- Processing Meta -->
                <div class="ew-meta" id="ewMeta"></div>
            </div>

            <!-- Training Results -->
            <div class="training-results" id="trainingResults" style="display: none;">
                <!-- Training Status -->
                <div class="training-status-banner" id="trainingStatusBanner">
                    <div class="training-status-icon" id="trainingStatusIcon">
                        <svg viewBox="0 0 24 24" width="32" height="32" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                    </div>
                    <div class="training-status-info">
                        <h3 id="trainingStatusTitle">Training Status</h3>
                        <p id="trainingStatusMessage">Initializing...</p>
                    </div>
                </div>

                <!-- Live Metrics -->
                <div class="training-section metrics-section">
                    <h3>
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"/>
                            <line x1="12" y1="20" x2="12" y2="4"/>
                            <line x1="6" y1="20" x2="6" y2="14"/>
                        </svg>
                        Live Training Metrics
                    </h3>
                    <div class="metrics-grid" id="metricsGrid">
                        <div class="metric-card">
                            <div class="metric-label">Epoch</div>
                            <div class="metric-value" id="currentEpoch">0/0</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Train Loss</div>
                            <div class="metric-value" id="trainLoss">-</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Train Accuracy</div>
                            <div class="metric-value" id="trainAccuracy">-</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Val Loss</div>
                            <div class="metric-value" id="valLoss">-</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Val Accuracy</div>
                            <div class="metric-value" id="valAccuracy">-</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Best Val Acc</div>
                            <div class="metric-value" id="bestValAccuracy">-</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Learning Rate</div>
                            <div class="metric-value" id="currentLR">-</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">ETA</div>
                            <div class="metric-value" id="trainingETA">-</div>
                        </div>
                    </div>
                </div>

                <!-- Training Progress Chart -->
                <div class="training-section chart-section">
                    <h3>
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                        </svg>
                        Training Progress
                    </h3>
                    <div class="chart-container">
                        <canvas id="trainingChart" width="600" height="300"></canvas>
                    </div>
                </div>

                <!-- Training Log -->
                <div class="training-section log-section">
                    <h3>
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        Training Log
                    </h3>
                    <div class="training-log" id="trainingLog">
                        <div class="log-entry">Waiting for training to start...</div>
                    </div>
                </div>

                <!-- Model Testing Section -->
                <div class="training-section test-section" id="testSection" style="display: none;">
                    <h3>
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                        </svg>
                        Test Trained Model
                    </h3>
                    <div class="test-upload-area" id="testUploadArea">
                        <div class="test-upload-content">
                            <svg viewBox="0 0 24 24" width="40" height="40" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="17 8 12 3 7 8"/>
                                <line x1="12" y1="3" x2="12" y2="15"/>
                            </svg>
                            <p>Drop an image here to test with trained model</p>
                        </div>
                        <input type="file" id="testFileInput" accept="image/*" hidden>
                    </div>
                    <div class="test-results" id="testResults" style="display: none;">
                        <div class="test-image-preview">
                            <img id="testImagePreview" alt="Test image">
                        </div>
                        <div class="test-predictions" id="testPredictions"></div>
                    </div>
                </div>

                <!-- Training Summary (shown after completion) -->
                <div class="training-section summary-section" id="trainingSummary" style="display: none;">
                    <h3>
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        Training Complete
                    </h3>
                    <div class="summary-content" id="summaryContent"></div>
                    <div class="summary-actions">
                        <button class="btn-primary" id="deployModelBtn">
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="17 8 12 3 7 8"/>
                                <line x1="12" y1="3" x2="12" y2="15"/>
                            </svg>
                            Deploy as Default Model
                        </button>
                        <button class="btn-secondary" id="downloadModelBtn">
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7 10 12 15 17 10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                            Download Model
                        </button>
                        <button class="btn-secondary" id="exportToHFBtn">
                            Export to HuggingFace
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- API Status Panel (collapsible) -->
        <details class="api-panel">
            <summary>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                </svg>
                API Status & Details
            </summary>
            <div class="api-panel-content">
                <div class="api-endpoints">
                    <h4>Available Endpoints</h4>
                    <div class="endpoint-list" id="endpointList">
                        <div class="endpoint">
                            <span class="method post">POST</span>
                            <span class="path">/api/v1/classify</span>
                            <span class="desc">Full classification</span>
                        </div>
                        <div class="endpoint">
                            <span class="method post">POST</span>
                            <span class="path">/api/v1/classify/species</span>
                            <span class="desc">Species only</span>
                        </div>
                        <div class="endpoint">
                            <span class="method post">POST</span>
                            <span class="path">/api/v1/classify/disease</span>
                            <span class="desc">Disease only</span>
                        </div>
                        <div class="endpoint">
                            <span class="method post">POST</span>
                            <span class="path">/api/v1/classify/batch</span>
                            <span class="desc">Batch (10 max)</span>
                        </div>
                        <div class="endpoint">
                            <span class="method get">GET</span>
                            <span class="path">/api/v1/health</span>
                            <span class="desc">Health check</span>
                        </div>
                    </div>
                </div>
                <div class="api-models" id="apiModels">
                    <h4>Loaded Models</h4>
                    <div class="models-info">Loading...</div>
                </div>
            </div>
        </details>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>Plant Disease Classifier API v0.1.0</p>
        <a href="/docs" target="_blank">API Documentation</a>
    </footer>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="/static/js/app.js"></script>
</body>
</html>
